# Build stage with Maven + JDK 17
FROM maven:3.9.9-eclipse-temurin-17 AS builder

WORKDIR /app

# Copy pom first for dependency cache
COPY pom.xml ./
COPY src ./src

# Build without tests for faster CI image
RUN mvn -B -DskipTests package --no-transfer-progress

# Runtime stage
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

# Explicit jar name generated by Maven
ARG JAR_FILE=target/PartAsign-Recepcion-MS-0.0.1-SNAPSHOT.jar
COPY --from=builder /app/${JAR_FILE} app.jar

EXPOSE 9102

# Respect Railway PORT; allow custom JVM opts
ENV JAVA_OPTS=""
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -Dserver.port=${PORT:-9102} -jar app.jar"]
